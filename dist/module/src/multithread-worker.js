(globalThis||self||window).listeners=new class{constructor(){this.typeListeners={},this.addTypeListener("default",(e=>e)),this.self.onmessage=e=>{this.listen(e)}}get self(){return globalThis}listen(e){const{id:s,data:t}=e.data;"object"==typeof t&&"type"in t&&t.type in this.typeListeners?this.typeListeners[t.type](s,t,e):this.typeListeners.default(s,t,e)}addTypeListener(e,s,t={}){const{keepMessageEvent:i,propertyAccessor:n}=t;this.typeListeners[e]=(e,t,a)=>{const o=n?t[n]:t,r=s(...i?[a,o]:[o]);r instanceof Promise?r.then((s=>{this.self.postMessage({id:e,data:s})})).catch(console.error):this.self.postMessage({id:e,data:r})}}};